<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SportPress é«”è‚²æ–°èç”¢ç¨¿ç³»çµ±</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Oswald:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #E63946;
            --primary-dark: #B82E3A;
            --secondary: #1D3557;
            --accent: #F4A261;
            --dark: #0D1B2A;
            --dark-surface: #1B2838;
            --dark-card: #243447;
            --text-primary: #F1FAEE;
            --text-secondary: #A8DADC;
            --text-muted: #6B8A8E;
            --success: #2ECC71;
            --warning: #F39C12;
            --border: rgba(168, 218, 220, 0.15);
            --shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
            --radius: 12px;
            --radius-sm: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Login Screen */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(230, 57, 70, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(29, 53, 87, 0.3) 0%, transparent 50%),
                var(--dark);
            padding: 20px;
        }

        .login-container {
            width: 100%;
            max-width: 420px;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-logo h1 {
            font-family: 'Oswald', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            letter-spacing: 4px;
            color: var(--text-primary);
            text-transform: uppercase;
        }

        .login-logo h1 span {
            color: var(--primary);
        }

        .login-logo p {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 8px;
            letter-spacing: 2px;
        }

        .login-card {
            background: var(--dark-surface);
            border-radius: var(--radius);
            padding: 40px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 14px 16px;
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.2);
        }

        .form-group input::placeholder {
            color: var(--text-muted);
        }

        /* Option Buttons */
        .option-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .option-buttons.style-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .option-btn {
            flex: 1;
            min-width: 80px;
            padding: 10px 12px;
            background: var(--dark);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .option-btn:hover {
            border-color: var(--text-muted);
            color: var(--text-primary);
        }

        .option-btn.active {
            border-color: var(--primary);
            background: rgba(230, 57, 70, 0.15);
            color: var(--text-primary);
        }

        .style-options .option-btn {
            padding: 12px 10px;
            font-size: 0.9rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 28px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(230, 57, 70, 0.4);
        }

        .btn-primary:disabled {
            background: var(--dark-card);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--dark-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--secondary);
            border-color: var(--secondary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
            padding: 10px 16px;
        }

        .btn-ghost:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }

        .btn-full {
            width: 100%;
        }

        /* Main App Layout */
        .app-container {
            display: none;
            min-height: 100vh;
        }

        .app-container.active {
            display: block;
        }

        /* Header */
        .header {
            background: var(--dark-surface);
            border-bottom: 1px solid var(--border);
            padding: 0 24px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-logo {
            font-family: 'Oswald', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--text-primary);
        }

        .header-logo span {
            color: var(--primary);
        }

        .header-nav {
            display: flex;
            gap: 8px;
        }

        .nav-btn {
            padding: 10px 20px;
            font-size: 0.9rem;
            font-weight: 500;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .nav-btn:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-btn.active {
            color: var(--primary);
            background: rgba(230, 57, 70, 0.1);
        }

        .header-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-name {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Main Content */
        .main-content {
            padding: 32px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Page Sections */
        .page-section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Cards */
        .card {
            background: var(--dark-surface);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            padding: 28px;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title svg {
            color: var(--primary);
        }

        /* Two Column Layout */
        .two-column {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 24px;
        }

        @media (max-width: 1024px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }

        /* Input Section */
        .input-section .form-group {
            margin-bottom: 20px;
        }

        /* Draft Section */
        .draft-section {
            display: flex;
            flex-direction: column;
        }

        .draft-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .draft-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .draft-status.ready {
            color: var(--success);
        }

        .draft-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-muted);
        }

        .draft-status.ready .draft-status-dot {
            background: var(--success);
        }

        .draft-textarea {
            width: 100%;
            min-height: 350px;
            padding: 20px;
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 1rem;
            line-height: 1.8;
            resize: vertical;
            font-family: 'Noto Sans TC', sans-serif;
            transition: all 0.3s ease;
        }

        .draft-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .draft-textarea::placeholder {
            color: var(--text-muted);
        }

        .draft-textarea:disabled {
            background: var(--dark-card);
            color: var(--text-muted);
        }

        .char-count {
            text-align: right;
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 8px;
        }

        /* Platform Selection */
        .platform-selection {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .platform-selection h4 {
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 16px;
            color: var(--text-secondary);
        }

        .platform-checkboxes {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .platform-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: var(--dark);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .platform-checkbox:hover {
            border-color: var(--text-muted);
        }

        .platform-checkbox.selected {
            border-color: var(--primary);
            background: rgba(230, 57, 70, 0.1);
        }

        .platform-checkbox input {
            display: none;
        }

        .platform-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .platform-icon.threads { background: #000; color: #fff; }
        .platform-icon.facebook { background: #1877F2; color: #fff; }
        .platform-icon.instagram { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); color: #fff; }

        .platform-checkbox .check-icon {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: auto;
            transition: all 0.3s ease;
        }

        .platform-checkbox.selected .check-icon {
            background: var(--primary);
            border-color: var(--primary);
        }

        .platform-checkbox.selected .check-icon svg {
            display: block;
        }

        .platform-checkbox .check-icon svg {
            display: none;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        /* Loading Overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(13, 27, 42, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        /* Success Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--dark-surface);
            border-radius: var(--radius);
            padding: 40px;
            max-width: 480px;
            width: 100%;
            text-align: center;
            animation: modalIn 0.4s ease;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
        }

        .modal-icon.success {
            background: rgba(46, 204, 113, 0.15);
        }

        .modal-icon.success svg {
            color: var(--success);
        }

        .modal h2 {
            font-size: 1.5rem;
            margin-bottom: 16px;
        }

        .modal p {
            color: var(--text-muted);
            margin-bottom: 24px;
        }

        .publish-results {
            text-align: left;
            background: var(--dark);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-bottom: 24px;
        }

        .publish-result-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .publish-result-item:last-child {
            border-bottom: none;
        }

        .publish-result-item svg {
            color: var(--success);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 16px 24px;
            background: var(--dark-surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.4s ease;
            z-index: 1001;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--primary); }

        /* Settings Page */
        .settings-container {
            max-width: 800px;
        }

        .settings-group {
            background: var(--dark-surface);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            padding: 24px;
            margin-bottom: 20px;
        }

        .settings-group-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-group-title svg {
            color: var(--primary);
        }

        .setting-item {
            margin-bottom: 20px;
        }

        .setting-item:last-child {
            margin-bottom: 0;
        }

        .setting-item label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .setting-item .hint {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .setting-item input[type="text"],
        .setting-item input[type="url"],
        .setting-item textarea {
            width: 100%;
            padding: 12px 16px;
            background: var(--dark);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: 'Courier New', monospace;
        }

        .setting-item input:focus,
        .setting-item textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .setting-item textarea {
            min-height: 150px;
            resize: vertical;
            font-family: 'Noto Sans TC', sans-serif;
        }

        .input-with-button {
            display: flex;
            gap: 10px;
        }

        .input-with-button input {
            flex: 1;
        }

        .btn-test {
            padding: 12px 20px;
            background: var(--secondary);
            color: var(--text-primary);
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .btn-test:hover {
            background: #2a4a7a;
        }

        .test-result {
            margin-top: 10px;
            padding: 10px 14px;
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            display: none;
        }

        .test-result.success {
            display: block;
            background: rgba(46, 204, 113, 0.15);
            color: var(--success);
        }

        .test-result.error {
            display: block;
            background: rgba(230, 57, 70, 0.15);
            color: var(--primary);
        }

        .settings-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        /* Variable Tags */
        .variable-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .variable-tag {
            padding: 4px 10px;
            background: var(--secondary);
            border-radius: 4px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .variable-tag:hover {
            background: var(--primary);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header { padding: 0 16px; }
            .header-nav { display: none; }
            .main-content { padding: 20px 16px; }
            .platform-checkboxes { flex-direction: column; }
            .action-buttons { flex-direction: column; }
        }

        /* History Section */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .history-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: var(--dark);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
        }

        .history-item-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .history-item-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .history-item-details h4 {
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .history-item-details p {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .history-item-meta {
            text-align: right;
        }

        .history-item-date {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .history-item-platforms {
            display: flex;
            gap: 4px;
            justify-content: flex-end;
        }

        .history-item-platforms span {
            padding: 2px 8px;
            background: var(--dark-card);
            border-radius: 4px;
            font-size: 0.7rem;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="login-logo">
                <h1>Sport<span>Press</span></h1>
                <p>é«”è‚²æ–°èç”¢ç¨¿ç³»çµ±</p>
            </div>
            <div class="login-card">
                <form id="loginForm">
                    <div class="form-group">
                        <label>å¸³è™Ÿ</label>
                        <input type="text" id="loginUsername" placeholder="è«‹è¼¸å…¥æ‚¨çš„å¸³è™Ÿ" required>
                    </div>
                    <div class="form-group">
                        <label>å¯†ç¢¼</label>
                        <input type="password" id="loginPassword" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">ç™»å…¥ç³»çµ±</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <header class="header">
            <div class="header-logo">Sport<span>Press</span></div>
            <nav class="header-nav">
                <button class="nav-btn active" data-page="create">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 20h9"/>
                        <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                    </svg>
                    ç”¢ç”Ÿè²¼æ–‡
                </button>
                <button class="nav-btn" data-page="history">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    ç™¼æ–‡ç´€éŒ„
                </button>
                <button class="nav-btn" data-page="settings">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    ç³»çµ±è¨­å®š
                </button>
            </nav>
            <div class="header-user">
                <span class="user-name" id="userName">ä½¿ç”¨è€…</span>
                <div class="user-avatar" id="userAvatar">U</div>
                <button class="btn btn-ghost" id="logoutBtn">ç™»å‡º</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Create Post Section -->
            <section class="page-section active" id="pageCreate">
                <div class="two-column">
                    <!-- Left: Input -->
                    <div class="input-section">
                        <div class="card">
                            <h3 class="card-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="m21 21-4.35-4.35"/>
                                </svg>
                                è¼¸å…¥çƒå“¡è³‡æ–™
                            </h3>
                            
                            <div class="form-group">
                                <label>é‹å‹•é¡å‹</label>
                                <select id="sportType">
                                    <option value="">è«‹é¸æ“‡</option>
                                    <option value="baseball">æ£’çƒ</option>
                                    <option value="basketball">ç±ƒçƒ</option>
                                </select>
                            </div>

                            <div class="form-group" id="positionGroup" style="display: none;">
                                <label>ä½ç½®</label>
                                <select id="position">
                                    <option value="">è«‹é¸æ“‡</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>çƒå“¡åå­—</label>
                                <input type="text" id="playerName" placeholder="ä¾‹å¦‚ï¼šæ—å®‰å¯">
                            </div>

                            <div class="form-group">
                                <label>æ–‡ç« é•·åº¦</label>
                                <div class="option-buttons" id="lengthOptions">
                                    <button type="button" class="option-btn" data-value="short">çŸ­ï¼ˆ50-100å­—ï¼‰</button>
                                    <button type="button" class="option-btn active" data-value="medium">ä¸­ï¼ˆ150-250å­—ï¼‰</button>
                                    <button type="button" class="option-btn" data-value="long">é•·ï¼ˆ300-500å­—ï¼‰</button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>è²¼æ–‡é¢¨æ ¼</label>
                                <div class="option-buttons style-options" id="styleOptions">
                                    <button type="button" class="option-btn active" data-value="professional">ğŸ“° å°ˆæ¥­æ­£å¼</button>
                                    <button type="button" class="option-btn" data-value="excited">ğŸ”¥ ç†±è¡€æ¿€æ˜‚</button>
                                    <button type="button" class="option-btn" data-value="humorous">ğŸ˜„ å¹½é»˜é¢¨è¶£</button>
                                    <button type="button" class="option-btn" data-value="analytical">ğŸ“Š æ•¸æ“šåˆ†æ</button>
                                    <button type="button" class="option-btn" data-value="storytelling">ğŸ“– æ•…äº‹æ•˜è¿°</button>
                                </div>
                            </div>

                            <button class="btn btn-primary btn-full" id="generateBtn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                                </svg>
                                ç”¢ç”Ÿç¤¾ç¾¤è²¼æ–‡
                            </button>
                            
                            <div class="webhook-status" id="webhookStatus" style="margin-top: 12px; padding: 10px; border-radius: 8px; font-size: 0.8rem; text-align: center;">
                                <!-- Status will be updated by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Right: Draft -->
                    <div class="draft-section">
                        <div class="card" style="flex: 1; display: flex; flex-direction: column;">
                            <div class="draft-header">
                                <h3 class="card-title" style="margin-bottom: 0;">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                    </svg>
                                    è²¼æ–‡è‰ç¨¿
                                </h3>
                                <div class="draft-status" id="draftStatus">
                                    <span class="draft-status-dot"></span>
                                    <span>ç­‰å¾…ç”¢ç”Ÿ</span>
                                </div>
                            </div>

                            <textarea class="draft-textarea" id="draftContent" placeholder="è¼¸å…¥çƒå“¡åå­—å¾Œï¼Œé»æ“Šã€Œç”¢ç”Ÿç¤¾ç¾¤è²¼æ–‡ã€ï¼ŒAI æœƒè‡ªå‹•ç”¢ç”Ÿè²¼æ–‡å…§å®¹...&#10;&#10;ä½ å¯ä»¥åœ¨é€™è£¡ç·¨è¼¯ä¿®æ”¹å…§å®¹ã€‚" disabled></textarea>
                            <div class="char-count"><span id="charCount">0</span> å­—</div>

                            <!-- Platform Selection -->
                            <div class="platform-selection">
                                <h4>é¸æ“‡ç™¼å¸ƒå¹³å°</h4>
                                <div class="platform-checkboxes">
                                    <label class="platform-checkbox" data-platform="threads">
                                        <input type="checkbox" value="threads">
                                        <div class="platform-icon threads">@</div>
                                        <span>Threads</span>
                                        <div class="check-icon">
                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                        </div>
                                    </label>
                                    <label class="platform-checkbox" data-platform="facebook">
                                        <input type="checkbox" value="facebook">
                                        <div class="platform-icon facebook">f</div>
                                        <span>Facebook</span>
                                        <div class="check-icon">
                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                        </div>
                                    </label>
                                    <label class="platform-checkbox" data-platform="instagram">
                                        <input type="checkbox" value="instagram">
                                        <div class="platform-icon instagram">IG</div>
                                        <span>Instagram</span>
                                        <div class="check-icon">
                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-secondary" id="clearBtn">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 6h18"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                    </svg>
                                    æ¸…é™¤
                                </button>
                                <button class="btn btn-success" id="publishBtn" disabled>
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M22 2 11 13"/>
                                        <path d="m22 2-7 20-4-9-9-4 20-7z"/>
                                    </svg>
                                    ç™¼å¸ƒè²¼æ–‡
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- History Section -->
            <section class="page-section" id="pageHistory">
                <div class="card">
                    <h3 class="card-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        ç™¼æ–‡ç´€éŒ„
                    </h3>
                    <div class="history-list" id="historyList">
                        <!-- History items will be populated here -->
                        <div class="history-item">
                            <div class="history-item-info">
                                <div class="history-item-avatar">æ—</div>
                                <div class="history-item-details">
                                    <h4>æ—å®‰å¯</h4>
                                    <p>æ£’çƒ / é‡æ‰‹</p>
                                </div>
                            </div>
                            <div class="history-item-meta">
                                <div class="history-item-date">2025/01/21 14:30</div>
                                <div class="history-item-platforms">
                                    <span>Threads</span>
                                    <span>FB</span>
                                </div>
                            </div>
                        </div>
                        <div class="history-item">
                            <div class="history-item-info">
                                <div class="history-item-avatar">é™³</div>
                                <div class="history-item-details">
                                    <h4>é™³ç›ˆé§¿</h4>
                                    <p>ç±ƒçƒ</p>
                                </div>
                            </div>
                            <div class="history-item-meta">
                                <div class="history-item-date">2025/01/20 18:00</div>
                                <div class="history-item-platforms">
                                    <span>Threads</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section class="page-section" id="pageSettings">
                <div class="settings-container">
                    <h2 style="margin-bottom: 24px;">ç³»çµ±è¨­å®š</h2>

                    <!-- Webhook 1: Generate Post -->
                    <div class="settings-group">
                        <h3 class="settings-group-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                            </svg>
                            Webhook 1ï¼šç”¢ç”Ÿç¤¾ç¾¤è²¼æ–‡
                        </h3>
                        <div class="setting-item">
                            <label>Webhook URL</label>
                            <div class="hint">è¼¸å…¥çƒå“¡å§“å â†’ æŸ¥ Google Sheet â†’ Claude ç”¢ç”Ÿè²¼æ–‡ â†’ å›å‚³è‰ç¨¿</div>
                            <div class="input-with-button">
                                <input type="url" id="webhookGenerate" placeholder="https://hook.make.com/xxx...">
                                <button class="btn-test" onclick="testWebhook('generate')">æ¸¬è©¦</button>
                            </div>
                            <div class="test-result" id="testResultGenerate"></div>
                        </div>
                    </div>

                    <!-- Webhook 2: Publish -->
                    <div class="settings-group">
                        <h3 class="settings-group-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 2 11 13"/>
                                <path d="m22 2-7 20-4-9-9-4 20-7z"/>
                            </svg>
                            Webhook 2ï¼šç™¼å¸ƒè²¼æ–‡
                        </h3>
                        <div class="setting-item">
                            <label>Webhook URL</label>
                            <div class="hint">æ¥æ”¶è²¼æ–‡å…§å®¹ â†’ ç™¼å¸ƒåˆ° Facebook / Instagram / Threads</div>
                            <div class="input-with-button">
                                <input type="url" id="webhookPublish" placeholder="https://hook.make.com/xxx...">
                                <button class="btn-test" onclick="testWebhook('publish')">æ¸¬è©¦</button>
                            </div>
                            <div class="test-result" id="testResultPublish"></div>
                        </div>
                    </div>

                    <!-- Google Sheet -->
                    <div class="settings-group">
                        <h3 class="settings-group-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <line x1="3" y1="9" x2="21" y2="9"/>
                                <line x1="9" y1="21" x2="9" y2="9"/>
                            </svg>
                            Google Sheet è¨­å®š
                        </h3>
                        <div class="setting-item">
                            <label>Google Sheet URL</label>
                            <div class="hint">çƒå“¡æ•¸æ“šè³‡æ–™åº«çš„ Google Sheet é€£çµ</div>
                            <input type="url" id="googleSheetUrl" placeholder="https://docs.google.com/spreadsheets/d/xxx...">
                        </div>
                    </div>

                    <!-- Prompt Template -->
                    <div class="settings-group">
                        <h3 class="settings-group-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 20h9"/>
                                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                            </svg>
                            Prompt åŸºç¤æ¨¡æ¿
                        </h3>
                        <div class="setting-item">
                            <div class="hint" style="margin-bottom: 16px; padding: 12px; background: var(--dark); border-radius: 8px;">
                                <strong>èªªæ˜ï¼š</strong>é€™æ˜¯åŸºç¤ Promptï¼Œç³»çµ±æœƒè‡ªå‹•åŠ ä¸Šã€Œé¢¨æ ¼è¦æ±‚ã€å’Œã€Œå­—æ•¸è¦æ±‚ã€å¾Œä¸€èµ·é€çµ¦ AIã€‚
                                <br><br>
                                <strong>é€å‡ºçš„å®Œæ•´ Prompt çµæ§‹ï¼š</strong><br>
                                1. åŸºç¤æ¨¡æ¿ï¼ˆä¸‹æ–¹è¨­å®šï¼‰<br>
                                2. é¢¨æ ¼è¦æ±‚ï¼ˆæ ¹æ“šé¸æ“‡çš„é¢¨æ ¼è‡ªå‹•åŠ å…¥ï¼‰<br>
                                3. å­—æ•¸è¦æ±‚ï¼ˆæ ¹æ“šé¸æ“‡çš„é•·åº¦è‡ªå‹•åŠ å…¥ï¼‰<br>
                                4. çƒå“¡è³‡æ–™ï¼ˆå¾ Google Sheet æŸ¥è©¢ï¼‰
                            </div>
                            <label>åŸºç¤ Prompt æ¨¡æ¿</label>
                            <textarea id="promptTemplate" rows="8">ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„é«”è‚²ç¤¾ç¾¤å°ç·¨ã€‚è«‹æ ¹æ“šä»¥ä¸‹çƒå“¡è³‡æ–™ï¼Œæ’°å¯«ä¸€ç¯‡é©åˆç¤¾ç¾¤åª’é«”ç™¼å¸ƒçš„è²¼æ–‡ã€‚

è¦æ±‚ï¼š
1. é–‹é ­è¦å¸å¼•çœ¼çƒï¼Œå¯ç”¨é©ç•¶çš„ emoji
2. é‡é»çªå‡ºçƒå“¡è¡¨ç¾å’Œæ•¸æ“š
3. é©åˆ Facebook / Instagram / Threads ç™¼å¸ƒ
4. çµå°¾åŠ ä¸Šç›¸é—œçš„ hashtag</textarea>
                        </div>
                        <div class="setting-item">
                            <label>é è¦½å®Œæ•´ Promptï¼ˆç”¢ç”Ÿè²¼æ–‡æ™‚æœƒé€å‡ºï¼‰</label>
                            <button class="btn btn-secondary" onclick="previewFullPrompt()" style="margin-top: 8px;">é è¦½å®Œæ•´ Prompt</button>
                            <div id="promptPreview" style="display: none; margin-top: 12px; padding: 16px; background: var(--dark); border-radius: 8px; font-size: 0.85rem; white-space: pre-wrap; color: var(--text-muted); max-height: 300px; overflow-y: auto;"></div>
                        </div>
                    </div>

                    <!-- é¢¨æ ¼è¨­å®šèªªæ˜ -->
                    <div class="settings-group">
                        <h3 class="settings-group-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="16" x2="12" y2="12"/>
                                <line x1="12" y1="8" x2="12.01" y2="8"/>
                            </svg>
                            é¢¨æ ¼èˆ‡é•·åº¦èªªæ˜
                        </h3>
                        <div class="setting-item">
                            <div style="display: grid; gap: 12px;">
                                <div style="padding: 12px; background: var(--dark); border-radius: 8px;">
                                    <strong>ğŸ“° å°ˆæ¥­æ­£å¼ï¼š</strong>ç”¨è©ç²¾æº–ã€å®¢è§€å ±å°ï¼Œé©åˆä¸»æµåª’é«”é¢¨æ ¼
                                </div>
                                <div style="padding: 12px; background: var(--dark); border-radius: 8px;">
                                    <strong>ğŸ”¥ ç†±è¡€æ¿€æ˜‚ï¼š</strong>å……æ»¿ç†±æƒ…èˆ‡èƒ½é‡ï¼Œå¼·çƒˆå½¢å®¹è©å’Œæ„Ÿå˜†å¥
                                </div>
                                <div style="padding: 12px; background: var(--dark); border-radius: 8px;">
                                    <strong>ğŸ˜„ å¹½é»˜é¢¨è¶£ï¼š</strong>æœ‰è¶£æ¯”å–»ã€ç¶²è·¯ç”¨èªã€è¼•é¬†èª¿ä¾ƒ
                                </div>
                                <div style="padding: 12px; background: var(--dark); border-radius: 8px;">
                                    <strong>ğŸ“Š æ•¸æ“šåˆ†æï¼š</strong>è‘—é‡æ•¸æ“šè§£è®€ã€çµ±è¨ˆæ¯”è¼ƒã€è¶¨å‹¢åˆ†æ
                                </div>
                                <div style="padding: 12px; background: var(--dark); border-radius: 8px;">
                                    <strong>ğŸ“– æ•…äº‹æ•˜è¿°ï¼š</strong>æç¹ªæ¯”è³½æƒ…å¢ƒã€çƒå“¡å¿ƒè·¯æ­·ç¨‹
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-actions">
                        <button class="btn btn-primary" onclick="saveSettings()">å„²å­˜è¨­å®š</button>
                        <button class="btn btn-secondary" onclick="exportSettings()">åŒ¯å‡ºè¨­å®š</button>
                        <button class="btn btn-ghost" onclick="importSettings()">åŒ¯å…¥è¨­å®š</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">æ­£åœ¨ç”¢ç”Ÿè²¼æ–‡...</div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="modal-icon success">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"/>
                </svg>
            </div>
            <h2>ç™¼å¸ƒæˆåŠŸï¼</h2>
            <p>è²¼æ–‡å·²æˆåŠŸç™¼å¸ƒåˆ°ä»¥ä¸‹å¹³å°</p>
            <div class="publish-results" id="publishResults">
                <!-- Results will be populated -->
            </div>
            <button class="btn btn-primary" onclick="closeModal()">å®Œæˆ</button>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
        </svg>
        <span id="toastMessage">æ“ä½œæˆåŠŸ</span>
    </div>

    <script>
        // ==================== State ====================
        const state = {
            currentUser: null,
            draftContent: '',
            selectedPlatforms: [],
            selectedLength: 'medium',
            selectedStyle: 'professional',
            isGenerating: false,
            isPublishing: false
        };

        // ==================== Length & Style Options ====================
        const LENGTH_OPTIONS = {
            short: { name: 'çŸ­', words: '50-100å­—', description: 'ç°¡çŸ­æœ‰åŠ›ï¼Œé©åˆå¿«é€Ÿç€è¦½' },
            medium: { name: 'ä¸­', words: '150-250å­—', description: 'å®Œæ•´å…§å®¹ï¼Œé©åˆä¸€èˆ¬ç™¼æ–‡' },
            long: { name: 'é•·', words: '300-500å­—', description: 'æ·±åº¦å ±å°ï¼Œé©åˆè©³ç´°åˆ†æ' }
        };

        const STYLE_OPTIONS = {
            professional: { 
                name: 'å°ˆæ¥­æ­£å¼', 
                emoji: 'ğŸ“°',
                prompt: 'è«‹ä»¥å°ˆæ¥­æ­£å¼çš„é«”è‚²æ–°èé¢¨æ ¼æ’°å¯«ï¼Œç”¨è©ç²¾æº–ã€å®¢è§€å ±å°ï¼Œé©åˆä¸»æµåª’é«”ç™¼å¸ƒã€‚'
            },
            excited: { 
                name: 'ç†±è¡€æ¿€æ˜‚', 
                emoji: 'ğŸ”¥',
                prompt: 'è«‹ä»¥ç†±è¡€æ¿€æ˜‚çš„é¢¨æ ¼æ’°å¯«ï¼Œå……æ»¿ç†±æƒ…èˆ‡èƒ½é‡ï¼Œä½¿ç”¨å¼·çƒˆçš„å½¢å®¹è©å’Œæ„Ÿå˜†å¥ï¼Œè®“è®€è€…æ„Ÿå—æ¯”è³½çš„æ¿€æƒ…ã€‚'
            },
            humorous: { 
                name: 'å¹½é»˜é¢¨è¶£', 
                emoji: 'ğŸ˜„',
                prompt: 'è«‹ä»¥å¹½é»˜é¢¨è¶£çš„é¢¨æ ¼æ’°å¯«ï¼Œé©ç•¶åŠ å…¥æœ‰è¶£çš„æ¯”å–»ã€ç¶²è·¯ç”¨èªæˆ–è¼•é¬†çš„èª¿ä¾ƒï¼Œè®“è®€è€…æœƒå¿ƒä¸€ç¬‘ã€‚'
            },
            analytical: { 
                name: 'æ•¸æ“šåˆ†æ', 
                emoji: 'ğŸ“Š',
                prompt: 'è«‹ä»¥æ•¸æ“šåˆ†æçš„é¢¨æ ¼æ’°å¯«ï¼Œè‘—é‡æ–¼æ•¸æ“šè§£è®€ã€çµ±è¨ˆæ¯”è¼ƒå’Œè¶¨å‹¢åˆ†æï¼Œç”¨æ•¸å­—èªªè©±ã€‚'
            },
            storytelling: { 
                name: 'æ•…äº‹æ•˜è¿°', 
                emoji: 'ğŸ“–',
                prompt: 'è«‹ä»¥æ•…äº‹æ•˜è¿°çš„é¢¨æ ¼æ’°å¯«ï¼Œæç¹ªæ¯”è³½æƒ…å¢ƒã€çƒå“¡å¿ƒè·¯æ­·ç¨‹ï¼Œè®“è®€è€…æœ‰èº«æ­·å…¶å¢ƒçš„æ„Ÿè¦ºã€‚'
            }
        };

        // ==================== 50 Users ====================
        const DEFAULT_USERS = [
            { id: 'U001', username: 'reporter01', password: 'sp2025r01', name: 'è¨˜è€…01' },
            { id: 'U002', username: 'reporter02', password: 'sp2025r02', name: 'è¨˜è€…02' },
            { id: 'U003', username: 'reporter03', password: 'sp2025r03', name: 'è¨˜è€…03' },
            { id: 'U004', username: 'reporter04', password: 'sp2025r04', name: 'è¨˜è€…04' },
            { id: 'U005', username: 'reporter05', password: 'sp2025r05', name: 'è¨˜è€…05' },
            { id: 'U006', username: 'reporter06', password: 'sp2025r06', name: 'è¨˜è€…06' },
            { id: 'U007', username: 'reporter07', password: 'sp2025r07', name: 'è¨˜è€…07' },
            { id: 'U008', username: 'reporter08', password: 'sp2025r08', name: 'è¨˜è€…08' },
            { id: 'U009', username: 'reporter09', password: 'sp2025r09', name: 'è¨˜è€…09' },
            { id: 'U010', username: 'reporter10', password: 'sp2025r10', name: 'è¨˜è€…10' },
            { id: 'U011', username: 'reporter11', password: 'sp2025r11', name: 'è¨˜è€…11' },
            { id: 'U012', username: 'reporter12', password: 'sp2025r12', name: 'è¨˜è€…12' },
            { id: 'U013', username: 'reporter13', password: 'sp2025r13', name: 'è¨˜è€…13' },
            { id: 'U014', username: 'reporter14', password: 'sp2025r14', name: 'è¨˜è€…14' },
            { id: 'U015', username: 'reporter15', password: 'sp2025r15', name: 'è¨˜è€…15' },
            { id: 'U016', username: 'reporter16', password: 'sp2025r16', name: 'è¨˜è€…16' },
            { id: 'U017', username: 'reporter17', password: 'sp2025r17', name: 'è¨˜è€…17' },
            { id: 'U018', username: 'reporter18', password: 'sp2025r18', name: 'è¨˜è€…18' },
            { id: 'U019', username: 'reporter19', password: 'sp2025r19', name: 'è¨˜è€…19' },
            { id: 'U020', username: 'reporter20', password: 'sp2025r20', name: 'è¨˜è€…20' },
            { id: 'U021', username: 'reporter21', password: 'sp2025r21', name: 'è¨˜è€…21' },
            { id: 'U022', username: 'reporter22', password: 'sp2025r22', name: 'è¨˜è€…22' },
            { id: 'U023', username: 'reporter23', password: 'sp2025r23', name: 'è¨˜è€…23' },
            { id: 'U024', username: 'reporter24', password: 'sp2025r24', name: 'è¨˜è€…24' },
            { id: 'U025', username: 'reporter25', password: 'sp2025r25', name: 'è¨˜è€…25' },
            { id: 'U026', username: 'reporter26', password: 'sp2025r26', name: 'è¨˜è€…26' },
            { id: 'U027', username: 'reporter27', password: 'sp2025r27', name: 'è¨˜è€…27' },
            { id: 'U028', username: 'reporter28', password: 'sp2025r28', name: 'è¨˜è€…28' },
            { id: 'U029', username: 'reporter29', password: 'sp2025r29', name: 'è¨˜è€…29' },
            { id: 'U030', username: 'reporter30', password: 'sp2025r30', name: 'è¨˜è€…30' },
            { id: 'U031', username: 'reporter31', password: 'sp2025r31', name: 'è¨˜è€…31' },
            { id: 'U032', username: 'reporter32', password: 'sp2025r32', name: 'è¨˜è€…32' },
            { id: 'U033', username: 'reporter33', password: 'sp2025r33', name: 'è¨˜è€…33' },
            { id: 'U034', username: 'reporter34', password: 'sp2025r34', name: 'è¨˜è€…34' },
            { id: 'U035', username: 'reporter35', password: 'sp2025r35', name: 'è¨˜è€…35' },
            { id: 'U036', username: 'reporter36', password: 'sp2025r36', name: 'è¨˜è€…36' },
            { id: 'U037', username: 'reporter37', password: 'sp2025r37', name: 'è¨˜è€…37' },
            { id: 'U038', username: 'reporter38', password: 'sp2025r38', name: 'è¨˜è€…38' },
            { id: 'U039', username: 'reporter39', password: 'sp2025r39', name: 'è¨˜è€…39' },
            { id: 'U040', username: 'reporter40', password: 'sp2025r40', name: 'è¨˜è€…40' },
            { id: 'U041', username: 'reporter41', password: 'sp2025r41', name: 'è¨˜è€…41' },
            { id: 'U042', username: 'reporter42', password: 'sp2025r42', name: 'è¨˜è€…42' },
            { id: 'U043', username: 'reporter43', password: 'sp2025r43', name: 'è¨˜è€…43' },
            { id: 'U044', username: 'reporter44', password: 'sp2025r44', name: 'è¨˜è€…44' },
            { id: 'U045', username: 'reporter45', password: 'sp2025r45', name: 'è¨˜è€…45' },
            { id: 'U046', username: 'reporter46', password: 'sp2025r46', name: 'è¨˜è€…46' },
            { id: 'U047', username: 'reporter47', password: 'sp2025r47', name: 'è¨˜è€…47' },
            { id: 'U048', username: 'reporter48', password: 'sp2025r48', name: 'è¨˜è€…48' },
            { id: 'U049', username: 'reporter49', password: 'sp2025r49', name: 'è¨˜è€…49' },
            { id: 'U050', username: 'reporter50', password: 'sp2025r50', name: 'è¨˜è€…50' },
            { id: 'U099', username: 'admin', password: 'admin2025!', name: 'ç®¡ç†å“¡' }
        ];

        // ==================== Settings ====================
        let SETTINGS = {
            webhookGenerate: '',
            webhookPublish: '',
            googleSheetUrl: '',
            promptTemplate: ''
        };

        // ==================== DOM Elements ====================
        const loginScreen = document.getElementById('loginScreen');
        const appContainer = document.getElementById('appContainer');
        const loginForm = document.getElementById('loginForm');
        const draftContent = document.getElementById('draftContent');
        const draftStatus = document.getElementById('draftStatus');
        const publishBtn = document.getElementById('publishBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingText = document.getElementById('loadingText');

        // ==================== Init ====================
        loadSettings();
        updateWebhookStatus();

        function updateWebhookStatus() {
            const statusEl = document.getElementById('webhookStatus');
            if (SETTINGS.webhookGenerate && SETTINGS.webhookGenerate.trim() !== '') {
                statusEl.style.background = 'rgba(46, 204, 113, 0.15)';
                statusEl.style.color = 'var(--success)';
                statusEl.innerHTML = 'âœ“ Webhook å·²è¨­å®šï¼Œå°‡é€£æ¥ Make.com';
            } else {
                statusEl.style.background = 'rgba(243, 156, 18, 0.15)';
                statusEl.style.color = 'var(--warning)';
                statusEl.innerHTML = 'âš  å°šæœªè¨­å®š Webhookï¼Œå°‡ä½¿ç”¨æ¨¡æ“¬è³‡æ–™ï¼ˆ<a href="#" onclick="document.querySelector(\'[data-page=settings]\').click(); return false;" style="color: var(--warning); text-decoration: underline;">å‰å¾€è¨­å®š</a>ï¼‰';
            }
        }

        // ==================== Login ====================
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            const user = DEFAULT_USERS.find(u => u.username === username && u.password === password);
            
            if (user) {
                state.currentUser = user;
                document.getElementById('userName').textContent = user.name;
                document.getElementById('userAvatar').textContent = user.name.slice(-2, -1) || user.name[0];
                loginScreen.style.display = 'none';
                appContainer.classList.add('active');
                showToast(`æ­¡è¿ ${user.name}ï¼`);
            } else {
                showToast('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤', 'error');
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            state.currentUser = null;
            appContainer.classList.remove('active');
            loginScreen.style.display = 'flex';
            loginForm.reset();
            clearDraft();
        });

        // ==================== Navigation ====================
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const page = btn.dataset.page;
                document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
                document.getElementById(`page${page.charAt(0).toUpperCase() + page.slice(1)}`).classList.add('active');
            });
        });

        // ==================== Sport Type Change ====================
        document.getElementById('sportType').addEventListener('change', (e) => {
            const positionGroup = document.getElementById('positionGroup');
            const positionSelect = document.getElementById('position');

            if (e.target.value === 'baseball') {
                positionGroup.style.display = 'block';
                positionSelect.innerHTML = `
                    <option value="">è«‹é¸æ“‡</option>
                    <option value="pitcher">æŠ•æ‰‹</option>
                    <option value="fielder">é‡æ‰‹</option>
                `;
            } else {
                positionGroup.style.display = 'none';
            }
        });

        // ==================== Length & Style Selection ====================
        document.querySelectorAll('#lengthOptions .option-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('#lengthOptions .option-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.selectedLength = btn.dataset.value;
            });
        });

        document.querySelectorAll('#styleOptions .option-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('#styleOptions .option-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.selectedStyle = btn.dataset.value;
            });
        });

        // ==================== Build Prompt ====================
        function buildPrompt(playerName, sport, position, stats, length, style) {
            const lengthInfo = LENGTH_OPTIONS[length];
            const styleInfo = STYLE_OPTIONS[style];
            
            // å–å¾—ä½¿ç”¨è€…è‡ªè¨‚çš„ Prompt æ¨¡æ¿
            const baseTemplate = SETTINGS.promptTemplate || getDefaultPromptTemplate();
            
            // çµ„åˆå®Œæ•´ Prompt
            const fullPrompt = `${baseTemplate}

ã€é¢¨æ ¼è¦æ±‚ã€‘
${styleInfo.prompt}

ã€å­—æ•¸è¦æ±‚ã€‘
è«‹å°‡è²¼æ–‡æ§åˆ¶åœ¨ ${lengthInfo.words}ï¼Œ${lengthInfo.description}ã€‚

ã€çƒå“¡è³‡æ–™ã€‘
çƒå“¡ï¼š${playerName}
é‹å‹•ï¼š${sport === 'baseball' ? 'æ£’çƒ' : 'ç±ƒçƒ'}
${position ? `ä½ç½®ï¼š${position === 'pitcher' ? 'æŠ•æ‰‹' : 'é‡æ‰‹'}` : ''}
æ•¸æ“šï¼š${stats || 'è«‹å¾è³‡æ–™åº«æŸ¥è©¢'}
`;
            return fullPrompt;
        }

        function getDefaultPromptTemplate() {
            return `ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„é«”è‚²ç¤¾ç¾¤å°ç·¨ã€‚è«‹æ ¹æ“šä»¥ä¸‹çƒå“¡è³‡æ–™ï¼Œæ’°å¯«ä¸€ç¯‡é©åˆç¤¾ç¾¤åª’é«”ç™¼å¸ƒçš„è²¼æ–‡ã€‚

è¦æ±‚ï¼š
1. é–‹é ­è¦å¸å¼•çœ¼çƒï¼Œå¯ç”¨é©ç•¶çš„ emoji
2. é‡é»çªå‡ºçƒå“¡è¡¨ç¾å’Œæ•¸æ“š
3. é©åˆ Facebook / Instagram / Threads ç™¼å¸ƒ
4. çµå°¾åŠ ä¸Šç›¸é—œçš„ hashtag`;
        }

        // ==================== Generate Post ====================
        document.getElementById('generateBtn').addEventListener('click', async () => {
            const sportType = document.getElementById('sportType').value;
            const position = document.getElementById('position').value;
            const playerName = document.getElementById('playerName').value.trim();

            if (!sportType) {
                showToast('è«‹é¸æ“‡é‹å‹•é¡å‹', 'error');
                return;
            }
            if (!playerName) {
                showToast('è«‹è¼¸å…¥çƒå“¡åå­—', 'error');
                return;
            }
            if (sportType === 'baseball' && !position) {
                showToast('è«‹é¸æ“‡ä½ç½®', 'error');
                return;
            }

            // Show loading
            showLoading('æ­£åœ¨ç”¢ç”Ÿè²¼æ–‡...');

            // Build the prompt
            const prompt = buildPrompt(
                playerName, 
                sportType, 
                position, 
                null, // stats will be fetched by Make
                state.selectedLength, 
                state.selectedStyle
            );

            // Prepare data - åŒ…å«æ‰€æœ‰é¸é …å’Œ Prompt
            const data = {
                // åŸºæœ¬è³‡æ–™
                sport: sportType,
                position: position || '',
                playerName: playerName,
                userId: state.currentUser?.id || 'guest',
                
                // é¸é …
                length: state.selectedLength,
                lengthDescription: LENGTH_OPTIONS[state.selectedLength].words,
                style: state.selectedStyle,
                styleDescription: STYLE_OPTIONS[state.selectedStyle].name,
                stylePrompt: STYLE_OPTIONS[state.selectedStyle].prompt,
                
                // å®Œæ•´ Prompt
                prompt: prompt
            };

            console.log('Sending to webhook:', data);
            console.log('Webhook URL:', SETTINGS.webhookGenerate);

            // Call webhook or use mock
            if (SETTINGS.webhookGenerate && SETTINGS.webhookGenerate.trim() !== '') {
                try {
                    console.log('Calling webhook...');
                    const response = await fetch(SETTINGS.webhookGenerate, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    
                    console.log('Response status:', response.status);
                    const result = await response.json();
                    console.log('Response data:', result);
                    
                    hideLoading();
                    
                    if (result.content) {
                        setDraft(result.content);
                    } else {
                        showToast('ç”¢ç”Ÿå¤±æ•—ï¼Œè«‹æª¢æŸ¥ Webhook å›å‚³æ ¼å¼', 'error');
                    }
                } catch (error) {
                    hideLoading();
                    console.error('Webhook error:', error);
                    showToast('é€£ç·šå¤±æ•—ï¼š' + error.message, 'error');
                }
            } else {
                // Mock response - æ²’æœ‰è¨­å®š Webhook æ™‚ä½¿ç”¨
                console.log('No webhook configured, using mock data');
                showToast('æç¤ºï¼šå°šæœªè¨­å®š Webhookï¼Œä½¿ç”¨æ¨¡æ“¬è³‡æ–™', 'success');
                setTimeout(() => {
                    hideLoading();
                    const mockContent = generateMockPost(playerName, sportType, position, state.selectedLength, state.selectedStyle);
                    setDraft(mockContent);
                }, 1500);
            }
        });

        function generateMockPost(name, sport, position, length, style) {
            const styleEmoji = STYLE_OPTIONS[style].emoji;
            
            // æ ¹æ“šé•·åº¦æ±ºå®šå…§å®¹
            let content = '';
            
            if (sport === 'baseball') {
                if (position === 'pitcher') {
                    if (length === 'short') {
                        content = `${styleEmoji} ${name} ä»Šæ—¥å…ˆç™¼å¥½æŠ•ï¼ä¸»æŠ•6å±€å¤±2åˆ†ã€K7ï¼Œç‡éšŠå¥ªå‹ ğŸ’ª\n\n#CPBL #${name}`;
                    } else if (length === 'long') {
                        content = `${styleEmoji} ${name} å¼·å‹¢ç™»æ¿ï¼Œå±•ç¾ç‹ç‰Œæ°£å‹¢ï¼

ä»Šæ—¥åœ¨ä¸»å ´é¢å°å¼·æ•µï¼Œ${name} ç¹³å‡ºç²¾å½©çš„å…ˆç™¼è¡¨ç¾ã€‚å¾ç¬¬ä¸€å±€é–‹å§‹å°±å±•ç¾çµ•ä½³çš„æ§çƒèƒ½åŠ›ï¼Œé€Ÿçƒç©©å®šç¶­æŒåœ¨ 145 å…¬é‡Œä»¥ä¸Šï¼Œè®ŠåŒ–çƒæ›´æ˜¯è®“æ‰“è€…é »é »æ®ç©ºã€‚

ğŸ“Š å®Œæ•´æ•¸æ“šï¼š
â€¢ ä¸»æŠ• 6.0 å±€
â€¢ åƒ…å¤± 2 åˆ†ï¼ˆè‡ªè²¬åˆ† 2ï¼‰
â€¢ ä¸‰æŒ¯ 7 æ¬¡
â€¢ ä¿é€ 2 æ¬¡  
â€¢ WHIP 1.05

é—œéµçš„ç¬¬äº”å±€ï¼Œé¢å°æ»¿å£˜å±æ©Ÿï¼Œ${name} å±•ç¾å¤§å°‡ä¹‹é¢¨ï¼Œé€£çºŒä¸‰æŒ¯åŒ–è§£éšªå¢ƒï¼Œå…¨å ´çƒè¿·æ²¸é¨°ï¼

ç¸½æ•™ç·´è³½å¾Œè¡¨ç¤ºï¼šã€Œä»–ä»Šå¤©çš„è¡¨ç¾éå¸¸ç©©å®šï¼Œé€™å°±æ˜¯æˆ‘å€‘æœŸå¾…çš„ç‹ç‰ŒæŠ•æ‰‹ã€‚ã€

${name} æœ¬å­£æŒçºŒç´¯ç©å¥½è¡¨ç¾ï¼Œæ˜¯çƒéšŠçˆ­å† çš„é‡è¦æˆ°åŠ›ï¼

#CPBL #æ£’çƒ #${name} #æŠ•æ‰‹ #å¥½æŠ•`;
                    } else {
                        content = `${styleEmoji} ${name} ä»Šæ—¥å…ˆç™¼è¡¨ç¾äº®çœ¼ï¼

ğŸ“Š ä¸»æŠ• 6 å±€åƒ…å¤± 2 åˆ†
ğŸ“Š ä¸‰æŒ¯ 7 äººã€WHIP 1.05
ğŸ“Š çƒé€Ÿç¶­æŒ 145km/h ä»¥ä¸Š

é—œéµæ™‚åˆ»å±•ç¾å£“åˆ¶åŠ›ï¼Œå¹«åŠ©çƒéšŠæ‹¿ä¸‹é‡è¦å‹åˆ©ï¼ä¸‹ä¸€å ´æ¯”è³½å€¼å¾—æœŸå¾… ğŸ’ª

#CPBL #æ£’çƒ #${name} #æŠ•æ‰‹`;
                    }
                } else {
                    if (length === 'short') {
                        content = `${styleEmoji} ${name} é–‹è½Ÿå•¦ï¼4æ‰“æ•¸3å®‰ã€1è½Ÿ3æ‰“é»ï¼ŒæŒçºŒç«ç‡™ ğŸ”¥\n\n#CPBL #${name}`;
                    } else if (length === 'long') {
                        content = `${styleEmoji} ${name} ä»Šæ—¥ç«åŠ›å…¨é–‹ï¼Œç‡éšŠå¤§å‹ï¼

ä¸»å ´è¿æˆ°çš„æ¯”è³½ä¸­ï¼Œ${name} ç”¨çƒæ£’è­‰æ˜è‡ªå·±æ˜¯è¯ç›Ÿæœ€å¯æ€•çš„æ‰“è€…ä¹‹ä¸€ã€‚å¾é¦–æ‰“å¸­é–‹å§‹å°±å±•ç¾çµ•ä½³æ‰‹æ„Ÿï¼Œå°‡çƒæ‰å¯¦æ“Šå‡ºå½¢æˆå®‰æ‰“ã€‚

ğŸ“Š ä»Šæ—¥å®Œæ•´æ•¸æ“šï¼š
â€¢ 4 æ‰“æ•¸ 3 å®‰æ‰“
â€¢ 1 ç™¼å…¨å£˜æ‰“ï¼ˆæœ¬å­£ç¬¬ 18 è½Ÿï¼‰
â€¢ 3 åˆ†æ‰“é»
â€¢ æ‰“æ“Šç‡æå‡è‡³ .325

äº”å±€ä¸‹åŠï¼Œ${name} é¢å°å°æ–¹å¼·æŠ•ï¼ŒæŠ“ä½ç´…ä¸­é€Ÿçƒï¼Œä¸€æ£’æƒå‘å·¦å¤–é‡å…¨å£˜æ‰“ç‰†ï¼Œä¸‰åˆ†å½ˆå¾¹åº•æ‰“çˆ†æ¯”è³½ï¼å…¨å ´çƒè¿·èµ·ç«‹é¼“æŒã€‚

ã€Œä»Šå¤©ç‹€æ³å¾ˆå¥½ï¼Œå°±æ˜¯å°ˆæ³¨åœ¨æ¯ä¸€å€‹æ‰“å¸­ã€‚ã€${name} è³½å¾Œè¬™è™›è¡¨ç¤ºã€‚

æœ¬å­£ ${name} æŒçºŒç©©å®šè¼¸å‡ºï¼Œæ˜¯çƒéšŠæ‰“ç·šçš„æ ¸å¿ƒæ”¯æŸ±ï¼Œå­£å¾Œè³½å¯æœ›æ‰®æ¼”é—œéµè§’è‰²ï¼

#CPBL #æ£’çƒ #${name} #å…¨å£˜æ‰“ #æ‰“æ“Šç‹`;
                    } else {
                        content = `${styleEmoji} ${name} ä»Šæ—¥é–‹è½Ÿï¼

ğŸ”¥ æ‰“æ“Šè¡¨ç¾è¶…ç«ç‡™
ğŸ“Š 4 æ‰“æ•¸ 3 å®‰æ‰“
ğŸ“Š 1 ç™¼å…¨å£˜æ‰“ã€3 åˆ†æ‰“é»
ğŸ“Š æœ¬å­£æ‰“æ“Šç‡ .325

é—œéµæ™‚åˆ»çš„å¯é æ‰“è€…ï¼ŒæŒçºŒç”¨è¡¨ç¾è­‰æ˜è‡ªå·±ï¼ğŸ‘Š

#CPBL #æ£’çƒ #${name} #å…¨å£˜æ‰“`;
                    }
                }
            } else {
                if (length === 'short') {
                    content = `${styleEmoji} ${name} 22åˆ†8ç±ƒæ¿6åŠ©æ”»ï¼Œä¸»å®°æ¯”è³½ï¼MVPç´šè¡¨ç¾ ğŸ†\n\n#PLG #${name}`;
                } else if (length === 'long') {
                    content = `${styleEmoji} ${name} ä»Šæ™šä¸»å®°å…¨å ´ï¼Œå¸¶é ˜çƒéšŠæ‹¿ä¸‹é—œéµå‹åˆ©ï¼

é¢å°åŒå€å‹æ•µçš„å¼·ç¢°ï¼Œ${name} å¾é–‹è³½å°±å±•ç¾ä¾µç•¥æ€§ï¼Œé »é »åˆ‡å…¥ç¦å€å–åˆ†ï¼Œå¤–ç·šæ‰‹æ„Ÿä¹Ÿååˆ†ç«ç‡™ã€‚

ğŸ“Š ä»Šæ™šå®Œæ•´æ•¸æ“šï¼š
â€¢ å¾—åˆ†ï¼š22 åˆ†
â€¢ ç±ƒæ¿ï¼š8 å€‹
â€¢ åŠ©æ”»ï¼š6 æ¬¡
â€¢ æŠ•ç±ƒå‘½ä¸­ç‡ï¼š52%
â€¢ ä¸‰åˆ†çƒï¼š4/7

ç¬¬å››ç¯€é—œéµæ™‚åˆ»ï¼Œ${name} é€£çºŒå…©æ¬¡æ€¥åœè·³æŠ•å‘½ä¸­ï¼Œå¹«åŠ©çƒéšŠæ‹‰é–‹æ¯”åˆ†å·®è·ã€‚æœ€å¾Œå…©åˆ†é˜æ›´æ˜¯è¦ªè‡ªæ“åˆ€æ§å ´ï¼Œç©©ç©©å®ˆä½å‹åˆ©ã€‚

ã€Œä»Šå¤©åœ˜éšŠé˜²å®ˆåšå¾—å¾ˆå¥½ï¼Œå¤§å®¶éƒ½å¾ˆæ‹šã€‚ã€${name} å°‡åŠŸå‹æ­¸çµ¦éšŠå‹ã€‚

ç¸½æ•™ç·´è³½å¾Œç››è®šï¼šã€Œä»–å°±æ˜¯æˆ‘å€‘çš„é ˜è¢–ï¼Œé—œéµæ™‚åˆ»ç¸½æ˜¯æŒºèº«è€Œå‡ºã€‚ã€

#PLG #ç±ƒçƒ #${name} #MVP`;
                } else {
                    content = `${styleEmoji} ${name} ä¸»å®°æ¯”è³½ï¼

ä»Šæ—¥æ•¸æ“šè¶…äº®çœ¼ ğŸ”¥
ğŸ“Š 22 åˆ† 8 ç±ƒæ¿ 6 åŠ©æ”»
ğŸ“Š å‘½ä¸­ç‡ 52%
ğŸ“Š ä¸‰åˆ†çƒ 4/7

é—œéµæ™‚åˆ»æŒºèº«è€Œå‡ºï¼Œå¸¶é ˜çƒéšŠæ‹¿ä¸‹å‹åˆ©ï¼MVP ç´šè¡¨ç¾ ğŸ†

#PLG #ç±ƒçƒ #${name}`;
                }
            }

            // æ ¹æ“šé¢¨æ ¼å¾®èª¿
            if (style === 'humorous') {
                content = content.replace('ï¼', 'ï¼ï¼ˆå¤ªæ‰¯äº†å§ï¼‰');
            } else if (style === 'excited') {
                content = content.replace('ï¼', 'ï¼ï¼ï¼ğŸ”¥ğŸ”¥ğŸ”¥');
            }

            return content;
        }

        function setDraft(content) {
            draftContent.value = content;
            draftContent.disabled = false;
            state.draftContent = content;
            updateCharCount();
            updateDraftStatus(true);
            publishBtn.disabled = false;
            showToast('è²¼æ–‡å·²ç”¢ç”Ÿï¼Œå¯ç·¨è¼¯å¾Œç™¼å¸ƒ');
        }

        function clearDraft() {
            draftContent.value = '';
            draftContent.disabled = true;
            state.draftContent = '';
            state.selectedPlatforms = [];
            document.querySelectorAll('.platform-checkbox').forEach(cb => cb.classList.remove('selected'));
            document.querySelectorAll('.platform-checkbox input').forEach(i => i.checked = false);
            updateCharCount();
            updateDraftStatus(false);
            publishBtn.disabled = true;
        }

        document.getElementById('clearBtn').addEventListener('click', clearDraft);

        function updateDraftStatus(ready) {
            if (ready) {
                draftStatus.classList.add('ready');
                draftStatus.innerHTML = '<span class="draft-status-dot"></span><span>å¯ç™¼å¸ƒ</span>';
            } else {
                draftStatus.classList.remove('ready');
                draftStatus.innerHTML = '<span class="draft-status-dot"></span><span>ç­‰å¾…ç”¢ç”Ÿ</span>';
            }
        }

        // ==================== Draft Editor ====================
        draftContent.addEventListener('input', () => {
            state.draftContent = draftContent.value;
            updateCharCount();
        });

        function updateCharCount() {
            document.getElementById('charCount').textContent = draftContent.value.length;
        }

        // ==================== Platform Selection ====================
        document.querySelectorAll('.platform-checkbox').forEach(cb => {
            cb.addEventListener('click', () => {
                const input = cb.querySelector('input');
                input.checked = !input.checked;
                cb.classList.toggle('selected', input.checked);
                
                state.selectedPlatforms = Array.from(document.querySelectorAll('.platform-checkbox input:checked'))
                    .map(i => i.value);
            });
        });

        // ==================== Publish ====================
        document.getElementById('publishBtn').addEventListener('click', async () => {
            const content = draftContent.value.trim();
            
            if (!content) {
                showToast('è«‹å…ˆç”¢ç”Ÿè²¼æ–‡å…§å®¹', 'error');
                return;
            }

            if (state.selectedPlatforms.length === 0) {
                showToast('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹ç™¼å¸ƒå¹³å°', 'error');
                return;
            }

            showLoading('æ­£åœ¨ç™¼å¸ƒè²¼æ–‡...');

            const data = {
                content: content,
                platforms: state.selectedPlatforms,
                userId: state.currentUser?.id || 'guest',
                playerName: document.getElementById('playerName').value,
                sport: document.getElementById('sportType').value
            };

            if (SETTINGS.webhookPublish) {
                try {
                    const response = await fetch(SETTINGS.webhookPublish, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    const result = await response.json();
                    hideLoading();
                    showSuccessModal(state.selectedPlatforms);
                } catch (error) {
                    hideLoading();
                    showToast('ç™¼å¸ƒå¤±æ•—', 'error');
                }
            } else {
                // Mock
                setTimeout(() => {
                    hideLoading();
                    showSuccessModal(state.selectedPlatforms);
                }, 1500);
            }
        });

        // ==================== Modal ====================
        function showSuccessModal(platforms) {
            const resultsDiv = document.getElementById('publishResults');
            resultsDiv.innerHTML = platforms.map(p => `
                <div class="publish-result-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"/>
                    </svg>
                    <span>${p.charAt(0).toUpperCase() + p.slice(1)}</span>
                    <span style="margin-left: auto; color: var(--success);">å·²ç™¼å¸ƒ</span>
                </div>
            `).join('');
            document.getElementById('successModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('successModal').classList.remove('active');
            clearDraft();
            document.getElementById('playerName').value = '';
            document.getElementById('sportType').value = '';
            document.getElementById('positionGroup').style.display = 'none';
        }

        // ==================== Loading ====================
        function showLoading(text) {
            loadingText.textContent = text;
            loadingOverlay.classList.add('active');
        }

        function hideLoading() {
            loadingOverlay.classList.remove('active');
        }

        // ==================== Toast ====================
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toast.classList.remove('success', 'error');
            toast.classList.add(type);
            toastMessage.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ==================== Settings ====================
        function loadSettings() {
            const saved = localStorage.getItem('sportpress_settings');
            if (saved) {
                SETTINGS = JSON.parse(saved);
                document.getElementById('webhookGenerate').value = SETTINGS.webhookGenerate || '';
                document.getElementById('webhookPublish').value = SETTINGS.webhookPublish || '';
                document.getElementById('googleSheetUrl').value = SETTINGS.googleSheetUrl || '';
                if (SETTINGS.promptTemplate) {
                    document.getElementById('promptTemplate').value = SETTINGS.promptTemplate;
                }
            }
        }

        function saveSettings() {
            SETTINGS = {
                webhookGenerate: document.getElementById('webhookGenerate').value.trim(),
                webhookPublish: document.getElementById('webhookPublish').value.trim(),
                googleSheetUrl: document.getElementById('googleSheetUrl').value.trim(),
                promptTemplate: document.getElementById('promptTemplate').value
            };
            localStorage.setItem('sportpress_settings', JSON.stringify(SETTINGS));
            console.log('Settings saved:', SETTINGS);
            updateWebhookStatus();
            showToast('è¨­å®šå·²å„²å­˜');
        }

        async function testWebhook(type) {
            const inputId = type === 'generate' ? 'webhookGenerate' : 'webhookPublish';
            const resultId = type === 'generate' ? 'testResultGenerate' : 'testResultPublish';
            const url = document.getElementById(inputId).value;
            const resultEl = document.getElementById(resultId);

            if (!url) {
                resultEl.className = 'test-result error';
                resultEl.textContent = 'è«‹å…ˆè¼¸å…¥ Webhook URL';
                return;
            }

            resultEl.className = 'test-result';
            resultEl.style.display = 'block';
            resultEl.style.background = 'var(--dark-card)';
            resultEl.style.color = 'var(--text-muted)';
            resultEl.textContent = 'æ¸¬è©¦ä¸­...';

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ test: true })
                });
                
                if (response.ok) {
                    resultEl.className = 'test-result success';
                    resultEl.textContent = 'âœ“ é€£ç·šæˆåŠŸï¼';
                } else {
                    resultEl.className = 'test-result error';
                    resultEl.textContent = `âœ— é€£ç·šå¤±æ•— (HTTP ${response.status})`;
                }
            } catch (error) {
                resultEl.className = 'test-result error';
                resultEl.textContent = `âœ— é€£ç·šéŒ¯èª¤`;
            }
        }

        function insertVariable(varName) {
            const textarea = document.getElementById('promptTemplate');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const text = textarea.value;
            const variable = `{{${varName}}}`;
            textarea.value = text.substring(0, start) + variable + text.substring(end);
            textarea.selectionStart = textarea.selectionEnd = start + variable.length;
            textarea.focus();
        }

        function exportSettings() {
            const blob = new Blob([JSON.stringify(SETTINGS, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sportpress_settings.json';
            a.click();
            showToast('è¨­å®šå·²åŒ¯å‡º');
        }

        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        SETTINGS = JSON.parse(event.target.result);
                        localStorage.setItem('sportpress_settings', JSON.stringify(SETTINGS));
                        loadSettings();
                        showToast('è¨­å®šå·²åŒ¯å…¥');
                    } catch {
                        showToast('åŒ¯å…¥å¤±æ•—', 'error');
                    }
                };
                reader.readAsText(e.target.files[0]);
            };
            input.click();
        }

        function previewFullPrompt() {
            const preview = document.getElementById('promptPreview');
            const prompt = buildPrompt('æ—å®‰å¯', 'baseball', 'fielder', 'æ‰“æ“Šç‡ .325ã€18 è½Ÿã€67 æ‰“é»', state.selectedLength, state.selectedStyle);
            preview.textContent = prompt;
            preview.style.display = preview.style.display === 'none' ? 'block' : 'none';
        }
    </script>
</body>
</html>
